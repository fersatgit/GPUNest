#version 460
layout(local_size_z=64)in;layout(binding=0)buffer SSBO0{ivec4 DistanceMap[128];uint HeightMap[];};layout(binding=1)buffer SSBO1{uint PlacementMap[];};layout(binding=2)buffer SSBO2{uint SheetWidth,HeightMapWidth,Rotations,reserved;uint SheetHeightMap[10050];uvec2 NFP[];};void main(){uint b,j,k;if(gl_LocalInvocationID.z>>Rotations==0){uint c=gl_LocalInvocationID.z<<(6-Rotations);uint d=(gl_GlobalInvocationID.x<<Rotations)+gl_LocalInvocationID.z;if(PlacementMap[d]==0){uvec2 e=uvec2(NFP[gl_GlobalInvocationID.x].x&0xFFFF,NFP[gl_GlobalInvocationID.x].x>>16);switch(NFP[gl_GlobalInvocationID.x].y){case 0:e=uvec2(e.x,e.y-(DistanceMap[c+48].z+DistanceMap[c+32].y));break;case 1:e=uvec2(e.x+(DistanceMap[c+32].x-DistanceMap[c+48].y),e.y);break;case 2:e=e.xy-uvec2(DistanceMap[c+16].y+DistanceMap[c+48].y,DistanceMap[c+32].y-DistanceMap[c+16].x);break;}uint f=0;for(b=0;b<e.x;b++)f+=SheetHeightMap[b];b=HeightMapWidth*c;uint g=HeightMap[b]+e.x;for(j=e.x,k=b+1;j<g;j++,k++)f+=max(SheetHeightMap[j],HeightMap[k]+e.y);for(j=g;j<SheetWidth;j++)f+=SheetHeightMap[j];PlacementMap[d]=f;}}}